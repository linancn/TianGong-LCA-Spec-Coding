app:
  description: é€šè¿‡MCPè°ƒç”¨å·¥å…·æå–LCAæ•°æ®åº“é‡Œçš„flows
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: workflow
  name: 2.æµæ•°æ®è·å– (é€šè¿‡MCP)
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/zhipuai:0.0.15@0fe895dabd88378b75fbd5a8b437b329094f9867de3db901dfee31945b30bd08
kind: app
version: 0.4.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 100
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10000
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: if-else
      id: 1758074244330-source-1758130999431-target
      source: '1758074244330'
      sourceHandle: source
      target: '1758130999431'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1758130999431-false-1757735791088-target
      source: '1758130999431'
      sourceHandle: 'false'
      target: '1757735791088'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1757735791088-source-1759133897723-target
      source: '1757735791088'
      sourceHandle: source
      target: '1759133897723'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: end
      id: 1759133897723-source-1757485441312-target
      source: '1759133897723'
      sourceHandle: source
      target: '1757485441312'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: code
      id: 1758130999431-true-1760335091488-target
      source: '1758130999431'
      sourceHandle: 'true'
      target: '1760335091488'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: end
      id: 1760335091488-source-1758131027101-target
      source: '1760335091488'
      sourceHandle: source
      target: '1758131027101'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: agent
      id: 1757154253960-source-1760348527985-target
      source: '1757154253960'
      sourceHandle: source
      target: '1760348527985'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: agent
        targetType: code
      id: 1760348527985-source-1758074244330-target
      source: '1760348527985'
      sourceHandle: source
      target: '1758074244330'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - label: flow_name
          max_length: null
          options: []
          required: true
          type: paragraph
          variable: flow_name
        - allowed_file_extensions:
          - .md
          allowed_file_types:
          - custom
          allowed_file_upload_methods:
          - local_file
          label: paper
          max_length: null
          options: []
          required: true
          type: paragraph
          variable: paper
        - label: process_name
          max_length: null
          options: []
          required: true
          type: paragraph
          variable: process_name
      height: 141
      id: '1757154253960'
      position:
        x: -2048.536856017004
        y: 491.7010074358485
      positionAbsolute:
        x: -2048.536856017004
        y: 491.7010074358485
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        outputs:
        - value_selector:
          - '1759133897723'
          - result
          value_type: array[string]
          variable: final_exchange
        selected: false
        title: End
        type: end
      height: 89
      id: '1757485441312'
      position:
        x: -147.15658547001186
        y: 571.2161465558643
      positionAbsolute:
        x: -147.15658547001186
        y: 571.2161465558643
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params: {}
          mode: chat
          name: glm-4.5
          provider: langgenius/zhipuai/zhipuai
        prompt_template:
        - id: 407095a9-7dc4-4b95-b240-153fc8803f41
          role: system
          text: 'åŸºäºã€å½“å‰ Process ä¿¡æ¯ã€‘ä¸ã€æ–‡çŒ®ã€‘ï¼Œç²¾ç¡®å®šä¹‰ã€åŸå§‹æŸ¥è¯¢çš„flow_nameã€‘åœ¨è¯¥ Process ä¸Šä¸‹æ–‡ä¸­çš„å«ä¹‰ã€å±æ€§æˆ–çº¦æŸï¼Œå¹¶ä»ã€å€™é€‰
            Flow åˆ—è¡¨ã€‘ä¸­é€‰æ‹©å”¯ä¸€ä¸€ä¸ªæœ€åŒ¹é…çš„ Flowï¼Œè¿”å›æ ‡å‡†åŒ–ä¿¡æ¯ä¸ç®€æ˜ç†ç”±ï¼›è‹¥ä¿¡æ¯ä¸è¶³ï¼Œè¾“å‡ºéœ€è¡¥å……ä¿¡æ¯æ¸…å•è€Œä¸åšæ­¦æ–­åŒ¹é…ã€‚


            ã€åˆ¤å®šä¸é€‰æ‹©è§„åˆ™ï¼ˆä¸¥æ ¼æ‰§è¡Œï¼‰ã€‘

            A. æµç±»å‹ï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰

            è‹¥ exchange è¡¨ç¤ºäº§å“/åŸæ–™/èƒ½æºä¾›ç»™æˆ–æ¶ˆè€—ï¼ˆè¿›å…¥æˆ–ç¦»å¼€æŠ€æœ¯ç³»ç»Ÿè¾¹ç•Œçš„å•†å“/æœåŠ¡ï¼‰ï¼Œé€‰æ‹©äº§å“æµï¼ˆProduct flowï¼‰ã€‚

            è‹¥ exchange è¡¨ç¤ºç¯å¢ƒæ’æ”¾æˆ–èµ„æºæŠ½å–ï¼Œé€‰æ‹©åŸºç¡€æµï¼ˆElementary flowï¼‰ã€‚

            ä¾æ®åŸå§‹æŸ¥è¯¢çš„ direction å’Œè¯­å¢ƒåˆ¤å®šï¼›ä¸¤ç±»åŒæ—¶å‡ºç°æ—¶ï¼Œåªä¿ç•™ç¬¦åˆè¯­å¢ƒçš„ä¸€ç±»ã€‚

            B. ä»‹è´¨/compartmentï¼ˆä»…å¯¹åŸºç¡€æµï¼Œç¬¬äºŒä¼˜å…ˆçº§ï¼‰

            æ–‡çŒ®/è¿‡ç¨‹è‹¥æ˜ç¡®ä»‹è´¨æˆ–å­ç±»ï¼Œå¿…é¡»åŒ¹é…ï¼šç©ºæ°”/æ°´/åœŸå£¤åŠå…¶å­ç±»ï¼ˆå¦‚ indoorã€urban near groundã€high stacksã€unspecified
            ç­‰ï¼‰ã€‚

            å¯åˆç†æ¨æ–­æ—¶å…è®¸æ¨æ–­ï¼Œå¹¶åœ¨ç†ç”±ä¸­ç»™å‡ºä¾æ®ï¼šå¦‚â€œå®¤å†…æ“ä½œé—´æŒ¥å‘â†’air, indoorâ€ï¼Œâ€œé«˜æ¶çƒŸå›±â†’air, high stacksâ€ï¼Œâ€œåºŸæ°´å¤„ç†å•å…ƒâ†’emissions
            to waterâ€ç­‰ã€‚

            æ— æ³•ç¡®å®šæ—¶ä½¿ç”¨é»˜è®¤ï¼šAirâ†’Emissions to air, unspecifiedï¼›Waterâ†’Emissions to water,
            unspecifiedï¼›Soilâ†’Emissions to soil, unspecifiedã€‚

            ç¦æ­¢æ— ä¾æ®æ—¶é€‰æ‹©è¿‡åº¦ç»†åˆ†çš„å­ç±»ã€‚

            C. å•ä½ä¸ flow property ä¸€è‡´æ€§ï¼ˆç¬¬ä¸‰ä¼˜å…ˆçº§ï¼‰

            amount+unit åº”ä¸ flowProperties ä¸€è‡´ï¼ˆè´¨é‡/èƒ½é‡/ä½“ç§¯/ç‰©è´¨çš„é‡ç­‰ï¼‰ã€‚è‹¥ä¸ä¸€è‡´ï¼Œæç¤ºéœ€å•ä½æ¢ç®—æˆ–è¡¥å……ä¿¡æ¯ã€‚

            å€™é€‰ç¼ºå°‘ flowProperties æ—¶ï¼Œå¯åœ¨åç§°/ä»‹è´¨å¼ºä¸€è‡´å‰æä¸‹æš‚è¡ŒåŒ¹é…ï¼Œä½†éœ€åœ¨ç»“æœä¸­æç¤ºâ€œæ•°æ®åº“éœ€è¡¥å…… flow propertyâ€ã€‚

            D. åœ°ç†åŒ¹é…ï¼ˆç¬¬å››ä¼˜å…ˆçº§ï¼‰

            è‹¥è¿‡ç¨‹/æ–‡çŒ®æœ‰æ˜ç¡®åœ°åŸŸï¼Œä¼˜å…ˆ geography ä¸€è‡´çš„å€™é€‰ï¼›å¦åˆ™ geography=null æˆ– globalã€‚åœ°åŸŸå†²çªæ—¶ï¼Œä¼˜å…ˆä¸ process
            çš„ geography_context æ›´è´´åˆè€…ã€‚

            E. ç‰ˆæœ¬ä¸æ•°æ®è´¨é‡ï¼ˆç¬¬äº”ä¼˜å…ˆçº§ï¼‰

            å¤šç‰ˆæœ¬å¹¶å­˜æ—¶ï¼Œä¼˜å…ˆæœ€æ–°ç¨³å®šç‰ˆï¼Œå¿…è¦æ—¶å‚è€ƒæ•°æ®å¹´é™ä¸ä»£è¡¨æ€§ï¼Œå¹¶åœ¨ç†ç”±ä¸­ç®€è¿°ã€‚

            F. æ— åŒ¹é…å¤„ç†è§„åˆ™ï¼ˆå½“æ‰€æœ‰å€™é€‰ Flow å‡ä¸åŒ¹é…æ—¶ï¼‰

            name å­—æ®µï¼šå¡«å…¥ã€åŸå§‹æŸ¥è¯¢çš„ flow_nameã€‘ä¸­çš„ exchangeNameã€‚

            generalcomment å­—æ®µï¼šè¿½åŠ ã€åŸå§‹æŸ¥è¯¢çš„ flow_nameã€‘ä¸­çš„ descã€‚

            reasoning å­—æ®µï¼šæ ‡æ³¨ä½¿ç”¨åŸå§‹æŸ¥è¯¢ä¿¡æ¯ã€‚


            è¾“å‡ºè¦æ±‚ï¼š

            {"UUID":"","name":"A composite name for the flow, created by concatenating
            the following four components with a semicolon: baseName; treatmentStandardsRoutes;
            mixAndLocationTypes; flowProperties.","process_name":"The name of the
            process to which this flow belongs.","version":"","generalcomment":"","geography":"","classificationInformation":{"common:classification":{"common:class":[{"#text":"","@level":"","@classId":"","reasoning":
            "A detailed explanation of why the model made this choice."}]}}}'
        - id: bf2b29ab-4048-466e-b8a4-c27c7ca0c573
          role: user
          text: 'ã€å½“å‰Processä¿¡æ¯ã€‘

            {{#1757154253960.process_name#}}


            ã€æ–‡çŒ®ã€‘

            {{#1757154253960.paper#}}


            ã€åŸå§‹æŸ¥è¯¢çš„flow_nameã€‘

            {{#1757154253960.flow_name#}}


            ã€å€™é€‰Flowåˆ—è¡¨ã€‘

            {{#1758074244330.flows_to_judge#}}'
        selected: false
        structured_output:
          schema:
            properties:
              reasoning:
                description: æ¨¡å‹åšå‡ºè¯¥é€‰æ‹©çš„è¯¦ç»†ç†ç”±ã€‚
                type: string
              selected_flow:
                description: æ¨¡å‹é€‰æ‹©å‡ºçš„æœ€åŒ¹é…çš„Flowå¯¹è±¡ã€‚
                type: object
            required:
            - selected_flow
            - reasoning
            type: object
        structured_output_enabled: false
        title: glm-mcp
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1757735791088'
      position:
        x: -757.9031766096399
        y: 571.2161465558643
      positionAbsolute:
        x: -757.9031766096399
        y: 571.2161465558643
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import json\nfrom typing import Dict, Any, List\n\ndef get_text_from_list(data_list:\
          \ List[Dict[str, Any]], lang: str = 'en') -> List[str]:\n    \"\"\"\n  \
          \  è¾…åŠ©å‡½æ•°ï¼šå®‰å…¨åœ°ä» ILCD åˆ—è¡¨ç»“æ„ä¸­æå–æ‰€æœ‰æŒ‡å®šè¯­è¨€çš„ #text å€¼ã€‚\n    å¦‚æœ data_list ä¸æ˜¯åˆ—è¡¨ï¼Œåˆ™è¿”å›ç©ºåˆ—è¡¨ã€‚\n\
          \    \"\"\"\n    texts = []\n    if not isinstance(data_list, list):\n \
          \       return texts\n    for item in data_list:\n        if isinstance(item,\
          \ dict) and item.get(\"@xml:lang\") == lang and \"#text\" in item:\n   \
          \         texts.append(item[\"#text\"])\n    return texts\n\ndef main(original_query:\
          \ str, mcp_results: List[Dict[str, Any]]) -> Dict[str, Any]:\n    \"\"\"\
          \n    !! V13 ç‰ˆ - ç²¾ç¡®æå–ä¸è½¬æ¢ !!\n\n    æ­¤ç‰ˆæœ¬ä¼šä» Agent çš„å®Œæ•´æ—¥å¿—(mcp_results)ä¸­å‘åæŸ¥æ‰¾æœ€æ–°ä¸€æ¬¡æˆåŠŸçš„å·¥å…·å“åº”ï¼Œ\n\
          \    ç„¶åæ ¹æ®ç”¨æˆ·å®šä¹‰çš„ 6 æ¡ç²¾ç¡®è§„åˆ™ï¼Œä»åŸå§‹ã€å¤æ‚çš„ flowDataSet ç»“æ„ä¸­æå–\n    å’Œç»„åˆæ•°æ®ï¼Œæœ€ç»ˆç”Ÿæˆç®€æ´çš„ JSON\
          \ å­—ç¬¦ä¸²åˆ—è¡¨ã€‚\n    \"\"\"\n    \n    flows_to_judge_strings: List[str] = []\n\
          \    unmatched_queries_strings: List[str] = []\n    raw_json_string = None\n\
          \n    # 1. ä» Agent æ—¥å¿—æœ«å°¾å‘å‰æœç´¢ï¼Œæ‰¾åˆ°æœ€æ–°ä¸€æ¬¡æˆåŠŸçš„å·¥å…·å“åº”JSON\n    if isinstance(mcp_results,\
          \ list):\n        for log_entry in reversed(mcp_results):\n            try:\n\
          \                response_str = log_entry.get(\"data\", {}).get(\"output\"\
          , {}).get(\"tool_responses\", [{}])[0].get(\"tool_response\")\n        \
          \        if isinstance(response_str, str) and response_str.strip().startswith(\"\
          {\"):\n                    raw_json_string = response_str\n            \
          \        break\n            except (IndexError, AttributeError):\n     \
          \           continue\n\n    # 2. å¦‚æœæœªæ‰¾åˆ°ä»»ä½•æœ‰æ•ˆå“åº”ï¼Œåˆ™å°†åŸå§‹æŸ¥è¯¢å½’ä¸ºâ€œæœªåŒ¹é…â€\n    if not raw_json_string:\n\
          \        unmatched_queries_strings.append(original_query)\n        return\
          \ {\n            \"flows_to_judge\": flows_to_judge_strings,\n         \
          \   \"unmatched_queries\": unmatched_queries_strings\n        }\n\n    try:\n\
          \        # 3. è§£æå·¥å…·è¿”å›çš„åŸå§‹ã€å¤æ‚JSON\n        parsed_data = json.loads(raw_json_string)\n\
          \        flow_list = parsed_data.get(\"data\", [])\n\n        if not flow_list:\n\
          \            # å·¥å…·æˆåŠŸè¿”å›ï¼Œä½†ç»“æœåˆ—è¡¨ä¸ºç©º\n            unmatched_queries_strings.append(original_query)\n\
          \        else:\n            # 4. éå†æ¯ä¸€æ¡åŸå§‹è®°å½•ï¼Œå¹¶æ ¹æ®è§„åˆ™æå–\n            for flow_item\
          \ in flow_list:\n                flow_data = flow_item.get(\"json\", {}).get(\"\
          flowDataSet\", {})\n                if not flow_data:\n                \
          \    continue\n\n                info = flow_data.get(\"flowInformation\"\
          , {}).get(\"dataSetInformation\", {})\n                admin = flow_data.get(\"\
          administrativeInformation\", {})\n\n                # è§„åˆ™ 1-5: æå–å„ä¸ªå­—æ®µ\n \
          \               uuid = info.get(\"common:UUID\")\n                version\
          \ = admin.get(\"publicationAndOwnership\", {}).get(\"common:dataSetVersion\"\
          )\n                geography = flow_data.get(\"flowInformation\", {}).get(\"\
          geography\")\n                classification = info.get(\"classificationInformation\"\
          )\n                \n                general_comment_list = info.get(\"\
          common:generalComment\", [])\n                en_comments = get_text_from_list(general_comment_list,\
          \ 'en')\n                general_comment = en_comments[0] if en_comments\
          \ else None\n\n                # è§„åˆ™ 6: ç»„åˆ Name å­—æ®µ\n                name_info\
          \ = info.get(\"name\", {})\n                name_parts = []\n          \
          \      name_parts.extend(get_text_from_list(name_info.get(\"baseName\",\
          \ []), 'en'))\n                name_parts.extend(get_text_from_list(name_info.get(\"\
          treatmentStandardsRoutes\", []), 'en'))\n                name_parts.extend(get_text_from_list(name_info.get(\"\
          mixAndLocationTypes\", []), 'en'))\n                name_parts.extend(get_text_from_list(name_info.get(\"\
          flowProperties\", []), 'en'))\n                full_name = \"; \".join(filter(None,\
          \ name_parts)) if name_parts else None\n\n                # ç»„è£…æˆç®€æ´çš„å¯¹è±¡\n \
          \               simplified_flow_object = {\n                    \"UUID\"\
          : uuid,\n                    \"version\": version,\n                   \
          \ \"geography\": geography,\n                    \"classificationInformation\"\
          : classification,\n                    \"generalcomment\": general_comment,\n\
          \                    \"name\": full_name\n                }\n          \
          \      \n                # å°†ç®€æ´å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶æ·»åŠ åˆ°è¾“å‡ºåˆ—è¡¨\n                flows_to_judge_strings.append(json.dumps(simplified_flow_object,\
          \ ensure_ascii=False))\n\n    except Exception as e:\n        # æ•è·æ‰€æœ‰è§£æé”™è¯¯ï¼Œå½’ä¸ºâ€œæœªåŒ¹é…â€\n\
          \        unmatched_queries_strings.append(original_query)\n\n    # 5. è¿”å›æœ€ç»ˆç»“æœ\n\
          \    return {\n        \"flows_to_judge\": flows_to_judge_strings,\n   \
          \     \"unmatched_queries\": unmatched_queries_strings\n    }"
        code_language: python3
        desc: ''
        outputs:
          flows_to_judge:
            children: null
            type: array[string]
          unmatched_queries:
            children: null
            type: array[string]
        selected: false
        title: ä»£ç æ‰§è¡Œ
        type: code
        variables:
        - value_selector:
          - '1760348527985'
          - text
          value_type: string
          variable: mcp_results
        - value_selector:
          - '1757154253960'
          - flow_name
          value_type: string
          variable: original_query
      height: 53
      id: '1758074244330'
      position:
        x: -1394.2069667638127
        y: 491.7010074358485
      positionAbsolute:
        x: -1394.2069667638127
        y: 491.7010074358485
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: not empty
            id: 860266b2-dd12-4a09-a6db-6bcaa1c07002
            value: ''
            varType: array[string]
            variable_selector:
            - '1758074244330'
            - unmatched_queries
          id: 'true'
          logical_operator: and
        desc: ''
        selected: false
        title: æ¡ä»¶åˆ†æ”¯ 2
        type: if-else
      height: 125
      id: '1758130999431'
      position:
        x: -1072.9713813340318
        y: 491.7010074358485
      positionAbsolute:
        x: -1072.9713813340318
        y: 491.7010074358485
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        outputs:
        - value_selector:
          - '1760335091488'
          - matched_flows
          value_type: string
          variable: unmatched_queries
        selected: false
        title: ç»“æŸ 2
        type: end
      height: 89
      id: '1758131027101'
      position:
        x: -439.0652848795163
        y: 211.87765466167366
      positionAbsolute:
        x: -439.0652848795163
        y: 211.87765466167366
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import json\nimport re\n\ndef find_first_complete_json(text: str):\n\
          \    \"\"\"\n    é€šè¿‡è®¡ç®—é…å¯¹çš„æ‹¬å·ï¼Œä»å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªå®Œæ•´çš„JSONå¯¹è±¡ã€‚\n    è¿™èƒ½æœ‰æ•ˆé¿å…\"Extra data\"\
          é”™è¯¯ã€‚\n    \"\"\"\n    start_pos = text.find('{')\n    if start_pos == -1:\n\
          \        return None, -1  # æœªæ‰¾åˆ°èµ·å§‹æ‹¬å·\n\n    brace_count = 0\n    for i in\
          \ range(start_pos, len(text)):\n        char = text[i]\n        if char\
          \ == '{':\n            brace_count += 1\n        elif char == '}':\n   \
          \         brace_count -= 1\n        \n        if brace_count == 0:\n   \
          \         # æ‰¾åˆ°äº†ä¸ç¬¬ä¸€ä¸ª'{'åŒ¹é…çš„'}'\n            return text[start_pos : i + 1],\
          \ i + 1\n    \n    return None, -1 # æ‹¬å·ä¸å¹³è¡¡\n\ndef main(arg1: str) -> dict:\n\
          \    \"\"\"\n    V9ç‰ˆæœ€ç»ˆä»£ç  - ä½¿ç”¨ç²¾ç¡®çš„æ‹¬å·åŒ¹é…ç®—æ³•æå–JSONï¼Œå½»åº•è§£å†³\"Extra data\"é—®é¢˜ã€‚\n   \
          \ \"\"\"\n    # æ­¥éª¤ 1: å®šä½å¹¶åˆ‡é™¤ <think>...</think> æ€è€ƒè¿‡ç¨‹\n    think_end_tag =\
          \ '</think>'\n    think_end_index = arg1.rfind(think_end_tag)\n    \n  \
          \  if think_end_index != -1:\n        content_after_think = arg1[think_end_index\
          \ + len(think_end_tag):]\n    else:\n        content_after_think = arg1\n\
          \n    # æ­¥éª¤ 2: ã€å…³é”®æ”¹åŠ¨ã€‘ä½¿ç”¨æ‹¬å·åŒ¹é…ç®—æ³•ï¼Œç²¾ç¡®æå–ç¬¬ä¸€ä¸ªå®Œæ•´çš„JSONå¯¹è±¡\n    json_string, _ = find_first_complete_json(content_after_think)\n\
          \n    if not json_string:\n         # å¦‚æœè¿ä¸€ä¸ªå®Œæ•´çš„JSONå¯¹è±¡éƒ½æ‰¾ä¸åˆ°ï¼Œå°±æŠ¥é”™\n        raise\
          \ ValueError(f\"åœ¨<think>æ ‡ç­¾åæœªæ‰¾åˆ°ä¸€ä¸ªç»“æ„å®Œæ•´çš„JSONå¯¹è±¡ã€‚å†…å®¹é¢„è§ˆ: '{content_after_think[:200]}...'\"\
          )\n\n    # æ­¥éª¤ 3: éªŒè¯å¹¶è¿”å›ç»“æœ\n    try:\n        # éªŒè¯æå–å‡ºçš„å­—ç¬¦ä¸²ç¡®å®æ˜¯æœ‰æ•ˆçš„JSON\n    \
          \    json.loads(json_string)\n        # æˆåŠŸåï¼ŒæŒ‰è¦æ±‚è¿”å›åŒ…å«è¯¥å­—ç¬¦ä¸²çš„æ•°ç»„\n        return\
          \ {\"result\": [json_string]}\n    except json.JSONDecodeError as e:\n \
          \       # å¦‚æœç²¾ç¡®æå–åä»ç„¶è§£æå¤±è´¥ï¼Œè¯´æ˜JSONæœ¬èº«æ ¼å¼æœ‰é—®é¢˜\n        raise ValueError(f\"æå–å‡ºçš„JSONå—æ ¼å¼æ— æ•ˆã€‚é”™è¯¯:\
          \ '{e}'. æå–å†…å®¹: '{json_string[:200]}...'\")"
        code_language: python3
        desc: ''
        outputs:
          result:
            children: null
            type: array[string]
        selected: false
        title: ä»£ç æ‰§è¡Œ 2
        type: code
        variables:
        - value_selector:
          - '1757735791088'
          - text
          value_type: string
          variable: arg1
      height: 53
      id: '1759133897723'
      position:
        x: -447.15658547001186
        y: 571.2161465558643
      positionAbsolute:
        x: -447.15658547001186
        y: 571.2161465558643
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import json\nfrom typing import List, Dict, Any\n\ndef main(unmatched_queries:\
          \ List[str], originflow: str) -> Dict[str, str]:\n    unmatched_names =\
          \ set()\n    try:\n        for query_str in unmatched_queries:\n       \
          \     # Clean up potentially double-escaped strings\n            cleaned_str\
          \ = query_str.replace('\\\\\"', '\"')\n            query_dict = json.loads(cleaned_str)\n\
          \            name = query_dict.get(\"exchangeName\")\n            if name:\n\
          \                unmatched_names.add(name.strip())\n    except Exception:\n\
          \        # If parsing fails, return an empty list as a string\n        return\
          \ {\"matched_flows\": \"[]\"}\n\n    if not unmatched_names:\n        return\
          \ {\"matched_flows\": \"[]\"}\n\n    try:\n        simplified_flows = json.loads(originflow)\n\
          \        if not isinstance(simplified_flows, list):\n            return\
          \ {\"matched_flows\": \"[]\"}\n    except Exception:\n        return {\"\
          matched_flows\": \"[]\"}\n\n    result_flows = []\n    for flow_object in\
          \ simplified_flows:\n        if not isinstance(flow_object, dict):\n   \
          \         continue\n\n        base_name = flow_object.get(\"baseName\")\n\
          \        \n        if base_name and base_name.strip() in unmatched_names:\n\
          \            result_flows.append(flow_object)\n            \n    # **Key\
          \ Change**: Convert the final list into a JSON string before returning\n\
          \    matched_flows_string = json.dumps(result_flows, ensure_ascii=False)\n\
          \    \n    return {\n        \"matched_flows\": matched_flows_string\n \
          \   }"
        code_language: python3
        desc: ''
        outputs:
          matched_flows:
            children: null
            type: string
        selected: false
        title: ä»£ç æ‰§è¡Œ 3
        type: code
        variables:
        - value_selector:
          - '1758074244330'
          - unmatched_queries
          value_type: array[string]
          variable: unmatched_queries
        - value_selector:
          - '1760348527985'
          - text
          value_type: string
          variable: originflow
      height: 53
      id: '1760335091488'
      position:
        x: -747.579672261593
        y: 211.87765466167366
      positionAbsolute:
        x: -747.579672261593
        y: 211.87765466167366
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        agent_parameters:
          mcp_servers_config:
            type: constant
            value: "{\n  \"TianGong_LCA_Remote\": {\n    \"transport\": \"streamable_http\"\
              ,\n    \"url\": \"https://lcamcp.tiangong.earth/mcp\",\n    \"headers\"\
              : {\n      \"Accept\": \"application/json,text/event-stream\",\n   \
              \   \"Authorization\": \"Bearer eyJlbWFpbCI6IjIyMzAwMDg3QG11Yy5lZHUuY24iLCJwYXNzd29yZCI6IiFxZCZINDIxIn0=\"\
              \n    },\n    \"timeout\": 50,\n    \"sse_read_timeout\": 50\n  }\n}"
          model:
            type: constant
            value:
              completion_params:
                enable_stream: false
              mode: chat
              model: gpt-5-mini
              model_type: llm
              provider: langgenius/openai/openai
              type: model-selector
          query:
            type: constant
            value: '1. ä½¿ç”¨{{#1757154253960.flow_name#}}ä½œä¸º `query` å‚æ•°ï¼Œè°ƒç”¨ `Search_flows_Tool`ã€‚

              2. å¯¹å·¥å…·è¿”å›çš„æ¯ä¸€æ¡å€™é€‰æµï¼Œæ‰§è¡Œä»¥ä¸‹éªŒè¯ã€‚å¿…é¡»æ»¡è¶³æ‰€æœ‰æ¡ä»¶ï¼šå€™é€‰æµçš„ `baseName` å¿…é¡»ä¸åŸå§‹æŸ¥è¯¢ä¸­çš„ `exchangeName`
              é«˜åº¦ç›¸ä¼¼æˆ–å®Œå…¨ä¸€è‡´ã€‚åŸå§‹æŸ¥è¯¢ `desc` ä¸­æ‰€æœ‰å…³é”®æŠ€æœ¯é™å®šè¯ï¼ˆä¾‹å¦‚ä¸“æœ‰åç§°ã€ç‰¹å®šåŒ–å­¦ç»„åˆ†ã€ç‰¹æ®Šå·¥è‰ºã€ç‰©ç†ç‰¹æ€§ç­‰ï¼‰å¿…é¡»åœ¨å€™é€‰æµçš„æè¿°ï¼ˆ`generalComment`ï¼‰æˆ–åç§°ä¸­æ‰¾åˆ°æ˜ç¡®çš„å¯¹åº”ã€‚

              3. å¦‚æœæ‰€æœ‰å€™é€‰é¡¹éƒ½ä¸æ»¡è¶³æ¡ä»¶ï¼ˆå·¥å…·ç›´æ¥è¿”å›ç©ºæ•°æ®ï¼Œæˆ–è¿”å›çš„æ‰€æœ‰å€™é€‰é¡¹å‡æœªé€šè¿‡éªŒè¯ï¼‰ï¼Œåˆ™å¿…é¡»æ„é€ å¹¶è¾“å‡ºä¸€ä¸ªåŒ…å«å•ä¸ªJSONå¯¹è±¡çš„æ•°ç»„ã€‚è¯¥å¯¹è±¡å¿…é¡»åŒ…å«ä»¥ä¸‹å­—æ®µï¼š"baseName":
              å€¼ä¸ºåŸå§‹æŸ¥è¯¢{{#1757154253960.flow_name#}}ä¸­çš„exchangeNameã€‚"generalComment":
              å€¼ä¸ºåŸå§‹æŸ¥è¯¢{{#1757154253960.flow_name#}}ä¸­çš„descã€‚"status": å€¼ä¸ºå­—ç¬¦ä¸² "requires_creation","process_name":å€¼ä¸º{{#1757154253960.process_name#}}ã€‚æ‰€æœ‰å…¶ä»–å­—æ®µï¼ˆUUID,
              treatmentStandardsRoutes, mixAndLocationTypes, flowProperties, version,
              geography, classificationInformationï¼‰çš„å€¼å‡ä¸ºnullã€‚

              å¦‚æœå­˜åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªé€šè¿‡éªŒè¯çš„å€™é€‰æµï¼Œä»…å¯¹è¿™äº›é€šè¿‡éªŒè¯çš„æµæ‰§è¡Œä»¥ä¸‹æ ¼å¼åŒ–æŒ‡ä»¤ï¼Œå¹¶ä»¥JSONæ•°ç»„æ ¼å¼è¾“å‡ºï¼š1.æå–å­—æ®µ: UUID, baseName,
              treatmentStandardsRoutes, mixAndLocationTypes, flowProperties, version,
              generalComment, geography, classificationInformationã€‚2. ä¸¥æ ¼æ‰å¹³ç»“æ„ï¼Œç¦æ­¢åˆ›å»ºåµŒå¥—å¯¹è±¡ã€‚3.
              ç¼ºå¤±å­—æ®µç”¨`null`å¡«å……ã€‚


              ç¤ºä¾‹è¾“å‡ºï¼š

              [{"UUID":"...","baseName":"...",...}, ...]'
        agent_strategy_label: FunctionCalling (æ”¯æŒ MCP å·¥å…·)
        agent_strategy_name: mcp_sse_function_calling
        agent_strategy_provider_name: junjiem/mcp_see_agent/mcp_see_agent
        desc: ''
        meta:
          minimum_dify_version: null
          version: 0.0.1
        output_schema: null
        plugin_unique_identifier: junjiem/mcp_see_agent:0.2.4@82caf96890992e9dec2c43c3fac82bfce8bd18a41de7c2b6948151b2d7f7b7a2
        selected: true
        title: Agent
        tool_node_version: '2'
        type: agent
      height: 145
      id: '1760348527985'
      position:
        x: -1744.536856017004
        y: 491.7010074358485
      positionAbsolute:
        x: -1744.536856017004
        y: 491.7010074358485
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: 2398.449071161085
      y: 277.8376809984811
      zoom: 0.977159931489649
